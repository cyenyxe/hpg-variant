/* 
 * File:   test_ws.c
 * Author: cgonzalez
 *
 * Created on July 11, 2013, 9:58 AM
 */

#include <stdio.h>
#include <stdlib.h>

#include <curl/curl.h>

#include <bioformats/db/cellbase_connector.h>
#include <commons/log.h>

static size_t buffer_size;


int init_http_environment(int ssl);
int http_post(char *url, char **params, char **params_values, int num_params, size_t (*write_function) (char*, size_t, size_t, void*), void *buffer);
const char *get_last_http_error(int err_code);
size_t save_response_to_buffer(char *contents, size_t size, size_t nmemb, void *userdata);


int main(int argc, char** argv) {
    init_http_environment(0);
    
    char *url = compose_cellbase_ws_request("ws.bioinfo.cipf.es", "latest", "hsa", "genomic/variant", "consequence_type");
    char *output_format = "of";
    char *variants = "1:14658896:A:C,1:14659997:T:C,1:14660705:G:C,1:14663429:A:G,1:14665122:A:G,1:14668056:C:.,1:14668371:G:A,1:14669134:A:.,1:14677461:C:T,\
1:14677802:A:G,1:14678580:C:G,1:14684368:A:G,1:14687998:T:A,1:14694973:T:A,1:14695503:G:A,1:14695777:G:A,1:14699196:C:T,1:14700669:A:G,1:14710293:A:C,\
1:14721675:T:C,1:14722359:T:C,1:14724957:G:C,1:14743155:G:A,1:14748351:A:G,1:14748619:C:T,1:14773778:C:T,1:14780660:T:C,1:14781051:A:G,1:14781426:A:C,\
1:14782670:T:C,1:14783592:A:.,1:14787734:C:T,1:14790404:G:C,1:14791672:T:C,1:14793530:C:G,1:14806807:C:T,1:14806875:T:C,1:14807236:T:A,1:14813781:T:C,\
1:14816778:A:C,1:14817398:G:T,1:14820507:C:T,1:14827649:A:.,1:14834248:G:A,1:14838740:G:A,1:14838967:A:G,1:14839009:A:T,1:14853587:C:T,1:14854704:T:G,\
1:14855412:C:T,1:14871777:A:G,1:14875400:A:G,1:14887376:G:.,1:14903902:T:C,1:14904485:C:T,1:14904927:C:T,1:14911358:T:G,1:14911378:A:T,1:14912260:A:G,\
1:14915334:T:A,1:14915462:A:G,1:14918352:G:C,1:14920636:T:C,1:14921458:A:C,1:14925677:T:A,1:14939531:T:C,1:14941584:A:G,1:14945201:A:C,1:14948354:T:C,\
1:14948892:A:G,1:14953770:C:G,1:14954712:T:C,1:14958600:T:C,1:14965400:C:T,1:14968809:C:G,1:14973526:G:A,1:14974059:T:C,1:14975625:G:C,1:14986431:G:A,\
1:14988097:T:C,1:14998801:A:G,1:15006255:G:T,1:15012949:A:G,1:15014563:C:.,1:15014574:A:G,1:15014887:G:A,1:15017570:T:C,1:15017753:G:A,1:15025342:C:T,\
1:15026243:A:G,1:15029323:T:C,1:15030107:G:.,1:15055797:G:A,1:15060606:A:G,1:15061675:C:T,1:15061886:G:A,1:15062280:T:C,1:15063006:T:G,1:15065327:G:A,\
1:15065503:A:C,1:15066442:T:C,1:15068031:C:T,1:15070401:A:G,1:15074791:T:C,1:15080539:A:G,1:15080893:G:T,1:15081469:A:G,1:15097331:C:.,1:15106616:T:C,\
1:15107144:C:G,1:15126311:G:A,1:15130062:C:T,1:15137991:A:G,1:15138800:G:.,1:15145684:C:T,1:15145768:C:A,1:15146539:T:A,1:15149071:G:C,1:15154253:G:A,\
1:15159392:T:C,1:15160805:G:C,1:15167920:G:A,1:15169836:A:T,1:15172259:G:A,1:15174535:T:G,1:15177189:T:C,1:15177446:T:C,1:15178638:C:G,1:15180065:T:C,\
1:15181385:A:G,1:15190986:T:C,1:15193036:T:C,1:15196003:T:C,1:15202574:A:G,1:15202887:A:G,1:15204190:A:T,1:15208446:A:T,1:15209109:A:G,1:15213454:C:A,\
1:15215158:A:G,1:15215681:C:A,1:15223870:T:C,1:15225407:G:A,1:15225545:C:T,1:15226883:A:G,1:15227584:A:G,1:15227828:T:C,1:15230092:G:T,1:15232209:T:C,\
:15232554:G:A,1:15233308:G:A,1:15234943:C:.,1:15250141:T:C,1:15250274:C:T,1:15251772:T:.,1:15265882:G:C,1:15272533:C:.,1:15278076:G:A,1:15281743:C:G,\
1:15284856:A:T,1:15285942:A:G,1:15287000:A:G,1:15297028:A:C,1:15302815:C:G,1:15307844:C:T,1:15328010:A:G,1:15328603:C:T,1:15329407:G:A,1:15337024:G:.,\
1:15338074:C:T,1:15343760:A:G,1:15354641:T:C,1:15357052:G:A,1:15366497:G:C,1:15368492:A:C,1:15372919:T:C,1:15375068:C:T,1:15375126:A:G,1:15376238:C:T,\
1:15376990:C:A,1:15379784:T:C,1:15379907:C:T,1:15384718:A:G,1:15384765:C:T,1:15384809:C:T,1:15384927:C:T,1:15385344:C:T,1:15386671:C:T,1:15388886:A:G,\
1:15389339:A:G,1:15394737:C:G,1:15397436:G:A,1:15400921:A:G,1:15401074:G:A,1:15401254:T:C,1:15402847:A:G,1:15402916:T:C,1:15411846:A:G,1:15414660:A:G,\
1:15417210:A:G,1:15417597:A:T,1:15417908:C:T,1:15420984:A:G,1:15421223:C:A,1:15421260:A:G,1:15423112:G:T,1:15431729:A:C,1:15432375:T:G,1:15438936:G:A,\
1:15439286:G:A,1:15448692:G:A,1:15451923:G:A,1:15451957:A:G,1:15461346:G:A,1:15472636:C:T,1:15472672:C:T,1:15504236:A:G,1:15512168:C:T,1:15526459:T:C,\
1:15535971:C:T,1:15536018:G:A,1:15550519:C:T,1:15553038:T:G,1:15553976:C:T,1:15555069:G:T,1:15571704:G:.,1:15571914:C:G,1:15579724:T:C,1:15591057:C:A,\
1:15598703:A:T,1:15599378:C:T,1:15599935:G:A,1:15600726:A:C,1:15600876:T:C,1:15605981:G:A,1:15635927:G:A,1:15669301:T:C,1:15669395:C:T,1:15683933:T:C,\
1:15686773:T:C,1:15694172:A:G,1:15701181:G:C,1:15704047:C:T,1:15704370:C:T,1:15704579:C:T,1:15704654:G:A,1:15706947:C:T,1:15714329:T:C,1:15715831:A:G,1:15716442:G:A,1:15721590:C:G,1:15729721:C:T,1:15732827:G:A,1:15733150:A:T,1:15733390:A:G,1:15743090:T:C,1:15746866:C:T,1:15773104:A:G,1:15773124:G:A,1:15782437:G:C,1:15782482:G:A,1:15782590:T:C,1:15791263:C:T,1:15791326:C:T,1:15794958:T:G,1:15805519:T:A,1:15820534:A:.,1:15827016:A:.,1:15832473:C:G,1:15841197:G:C,1:15841357:T:C,1:15855888:G:A,1:15857893:G:A,1:15858527:T:C,1:15865925:A:G,1:15869142:G:C,1:15878379:A:G,1:15887906:C:T,1:15888371:A:G,1:15888573:T:G,1:15893089:A:G,1:15906788:T:A,1:15918696:G:A,1:15921872:C:G,1:15922480:A:G,1:15926080:T:C,1:15932281:T:C,1:15947715:T:C,1:15960411:A:G,1:15982256:C:T,1:15987920:G:C,1:16026472:A:G,1:16038248:G:C,1:16040386:C:T,1:16040442:C:T,1:16069346:G:A,1:16074089:T:G,1:16077689:A:G,1:16099460:T:C,1:16124487:A:G,1:16125120:C:T,1:16125583:G:A,1:16132400:A:G,1:16139734:T:C,1:16146582:G:A,1:16147834:T:C,1:16151973:G:C,1:16155363:G:C,1:16169282:G:T,1:16179433:A:G,1:16182875:A:G,1:16204570:A:G,1:16205158:A:G,1:16206156:T:G,1:16208114:G:C,1:16209839:G:A,1:16217414:T:C,1:16240720:A:G,1:16241564:T:C,1:16314315:G:C,1:16322267:T:C,1:16361410:T:C,1:16368501:G:T,1:16380205:A:G,1:16383385:T:C,1:16391453:A:C,1:16398136:T:C,1:16399116:G:A,1:16403437:C:A,1:16412164:A:G,1:16440209:C:T,1:16446969:C:A,1:16447617:G:A,1:16458405:C:T,1:16472077:T:A,1:16475520:A:G,1:16475731:A:T,1:16480458:C:A,1:16490399:C:T,1:16492747:A:G,1:16493176:C:T,1:16494019:A:.,1:16495133:G:C,1:16540128:G:C,1:16541520:C:T,1:16588961:A:G,1:16589707:A:G,1:16612540:A:G,1:16612622:A:C,1:16649391:G:A,1:16658151:T:C,1:16658755:T:C,1:16666734:C:.,1:16667504:G:A,1:16667788:A:G,1:16669308:T:G,1:16676928:C:T,1:16679544:C:T,1:16681281:G:T,1:16687581:C:T,1:16700378:G:C,1:16767863:T:C,1:16792858:T:G,1:16793058:A:G,1:16795403:C:T,1:16796738:G:A,1:16796922:G:A,1:16804230:C:.,1:16816431:T:C,1:16817945:C:G,1:16832049:G:A,1:16902301:G:C,1:16908187:A:C,1:16918233:T:C,1:17118758:G:A,1:17162645:T:C,1:17172314:G:A,1:17180745:T:C,1:17187289:T:C,1:17195785:T:A,1:17198542:A:G,1:17213465:T:C,1:17215511:G:A,1:17221434:G:C,1:17232263:C:A,1:17243810:A:G,1:17244272:G:A,1:17244342:C:G,1:17244984:G:A,1:17247250:A:G,1:17247275:A:G,1:17247329:A:G,1:17250815:A:T,1:17251616:G:A,1:17255533:A:C,1:17259467:C:T,1:17261155:G:T,1:17262167:T:C,1:17263588:T:C,1:17264873:G:A,1:17264939:T:C,1:17265567:T:C,1:17267362:A:G,1:17269085:T:C,1:17269290:T:C,1:17273681:C:T,1:17274327:A:G,1:17274402:A:G,1:17274722:A:G,1:17276593:C:T,1:17277508:G:A,1:17280800:A:G,1:17285088:G:A,1:17285357:G:A,1:17286356:C:T,1:17294889:A:G,1:17295197:A:G,1:17295247:G:A,1:17295659:T:G,1:17296137:T:C,1:17297432:G:A,1:17297654:C:T,1:17297664:G:A,1:17299349:G:A,1:17300805:T:C,1:17301130:G:C,1:17302540:G:.,1:17304986:C:G,1:17309917:C:G,1:17311782:A:C,1:17313441:A:C,1:17329233:T:A,1:17337761:A:G,1:17338088:G:A,1:17339000:A:T,1:17349418:G:A,1:17353784:A:G,1:17358240:A:C,1:17358501:A:G,1:17358527:T:G,1:17360538:T:C,1:17363419:A:G,1:17380195:A:C,1:17382217:A:G,1:17384372:A:G,1:17387321:C:G,1:17392595:A:G,1:17392699:A:G,1:17396185:G:C,1:17401898:A:T,1:17404169:A:G,1:17406897:A:G,1:17422708:T:C,1:17422901:A:G,1:17425462:T:C,1:17429765:T:C,1:17430244:C:A,1:17432186:T:A,1:17433559:T:C,1:17437434:A:G,1:17446575:T:C,1:17448915:A:G,1:17450952:A:G,1:17451006:A:G,1:17451140:C:T,1:17458721:C:T,1:17460749:A:G,1:17463509:A:G,1:17463664:C:T,1:17464266:C:T,1:17468512:G:A,1:17477288:C:G,1:17482332:A:C,1:17483875:C:G,1:17484135:T:A,1:17491866:C:T,1:17501632:G:A,1:17506109:G:A,1:17519113:C:T,1:17523817:G:A,1:17527994:C:T,1:17530203:A:G,1:17532143:A:G,1:17534583:T:C,1:17539095:G:A,1:17547708:C:A,1:17548237:C:T,1:17548476:A:C,1:17553864:A:G,1:17559614:A:G,1:17563502:G:A,1:17564570:T:C,1:17567288:C:A,1:17571821:C:G,1:17571924:A:G,1:17572050:A:G,1:17576448:A:G,1:17580326:A:G,1:17580385:C:T,1:17588981:T:C,1:17595713:T:C,1:17599966:C:G,1:17618620:A:.,1:17620614:T:C,1:17627402:A:G,1:17635899:T:C,1:17636153:C:G,1:17653851:C:G,1:17702543:G:A,1:17705732:T:C,1:17710192:C:G,1:17710875:C:.,1:17719509:G:A,1:17728411:G:A,1:17731122:A:G,1:17741546:G:A,1:17744697:G:A,1:17745246:A:C,1:17750077:T:C,1:17751206:G:A,1:17756944:C:T,1:17763161:T:C,1:17765403:T:G,1:17767799:A:G,1:17792742:C:T,1:17835583:G:A,1:17849965:T:C,1:17857696:C:T,1:17862352:T:G,1:17871507:G:C,1:17877810:A:T,1:17877966:G:T,1:17891444:T:C,1:17900141:T:G,1:17904120:G:T,1:17919980:T:C,1:17923025:G:A,1:17929104:A:.,1:17931831:T:.,1:17942995:G:A,1:17946092:C:T,1:17946929:A:C,1:17956877:C:T,1:17960580:A:G,1:17963516:G:A,1:17963562:A:G,1:17963889:A:T,1:17964875:G:C,1:17983288:C:T,1:17984652:A:C,1:17995919:A:G,1:17998116:A:G,1:18004856:T:C,1:18005188:G:A,1:18016261:T:C,1:18029451:C:T,1:18030436:C:G,1:18032082:A:C,1:18032120:C:A,1:18032720:C:T,1:18036509:G:A,1:18037757:G:A,1:18041661:C:.,1:18042782:C:G,1:18043934:T:C,1:18048760:A:T,1:18051863:T:A,1:18073905:G:A,1:18074768:T:C,1:18075967:C:G,1:18077419:A:G,1:18082396:T:C,1:18082615:T:C,1:18084817:T:C,1:18093102:T:C,1:18101448:C:T,1:18103122:C:T,1:18109206:G:A,1:18113284:C:T,1:18113896:T:C,1:18118727:A:T,1:18126330:C:T,1:18138561:C:G,1:18140992:A:G,1:18141274:G:A,1:18143470:G:A,1:18143950:C:T,1:18146891:T:C,1:18147485:G:A,1:18158655:G:A,1:18159587:G:A,1:18161820:T:G,1:18161839:A:G,1:18162068:A:G,1:18162928:T:C,1:18165388:C:T,1:18165714:G:T,1:18166042:A:G,1:18167074:G:.,1:18169994:C:T,1:18170275:T:C,1:18180642:T:C,1:18183656:G:A,1:18183727:A:G,1:18187208:A:G,1:18191466:A:T,1:18191608:A:G,1:18197145:C:T,1:18197844:A:G,1:18202756:A:.,1:18205701:G:C,1:18209490:T:C,1:18209855:T:C,1:18210025:G:C,1:18211185:A:G,1:18212335:T:C,1:18212453:G:A,1:18212612:T:C,1:18215394:T:C,1:18215551:T:C,1:18215612:T:C,1:18215693:A:C,1:18215875:C:T,1:18218679:T:C,1:18218752:C:A,1:18222351:T:C,1:18222408:T:C,1:18223377:C:T,1:18223453:T:C,1:18228167:A:G,1:18232390:G:A,1:18234646:A:G,1:18235699:T:C,1:18235855:T:C,1:18235894:C:T,1:18238258:T:C,1:18239273:G:A,1:18242021:T:C,1:18245596:A:G,1:18246326:A:G,1:18247312:T:C,1:18247425:T:C,1:18250348:C:G,1:18254024:G:A,1:18255007:C:T,1:18265339:T:G,1:18266511:G:A,1:18268300:T:C,1:18277660:T:C,1:18278013:A:.,1:18284968:A:G,1:18295559:A:T,1:18298570:C:T,1:18301353:C:T,1:18302024:C:T,1:18304088:T:C,1:18313665:G:T,1:18313740:G:.,1:18314001:T:C,1:18320077:A:C,1:18320979:C:.,1:18333056:A:G,1:18341376:T:C,1:18343022:A:.,1:18343883:G:A,1:18344827:G:A,1:18346116:A:G,1:18348014:G:T,1:18348072:T:C,1:18348774:A:G,1:18348818:C:T,1:18350037:C:T,1:18350856:G:A,1:18353084:T:G,1:18356697:G:C,1:18357532:G:C,1:18360493:A:G,1:18362648:A:G,1:18363296:A:G,1:18367304:T:C,1:18376983:T:C,1:18377379:G:A,1:18379956:A:T,1:18381803:G:A,1:18382254:T:C,1:18383572:C:G,1:18387387:A:G,1:18397611:C:T,1:18397836:A:G,1:18401698:A:T,1:18409531:A:T,1:18422996:T:C,1:18423270:A:G,1:18423781:A:G,1:18427298:C:A,1:18428246:T:C,1:18434103:C:T,1:18436036:T:C,1:18436270:G:C,1:18436476:A:G,1:18437256:A:G,1:18439438:G:A,1:18439577:C:G,1:18442793:A:G,1:18449300:G:A,1:18450662:A:C,1:18450835:C:G,1:18457607:T:A,1:18459007:A:C,1:18459402:G:A,1:18462207:A:G,1:18462330:G:C,1:18464339:T:C,1:18468013:G:C,1:18468446:A:G,1:18470016:C:T,1:18474189:A:.,1:18474462:C:T,1:18479120:C:G,1:18485256:G:T,1:18501171:T:.,1:18502693:T:C,1:18502737:T:C,1:18502800:T:A,1:18503729:A:G,1:18506527:C:T,1:18515922:G:A,1:18515936:C:T,1:18515998:C:G,1:18523381:G:A,1:18523660:T:C,1:18530814:T:C,1:18531124:G:.,1:18537711:A:G,1:18538806:G:A,1:18540926:A:G,1:18542037:A:G,1:18550757:T:C,1:18554507:A:G,1:18561839:C:T,1:18562092:G:C,1:18562194:A:C,1:18564201:C:T,1:18566294:T:G,1:18568722:A:G,1:18568934:C:G,1:18572599:A:C,1:18573948:T:G,1:18575074:C:G,1:18575150:T:C,1:18578087:C:A,1:18578281:C:T,1:18579960:G:T,1:18594465:A:G,1:18595300:G:A,1:18595324:A:C,1:18609578:G:C,1:18609603:G:.,1:18630773:G:A,1:18634087:C:G,1:18634480:A:G,1:18637740:G:A,1:18637895:T:C,1:18639400:A:G,1:18642800:A:G,1:18660033:A:G,1:18663598:C:.,1:18666223:T:C,1:18666828:T:C,1:18667842:G:A,1:18669687:C:A,1:18676731:G:A,1:18680656:C:T,1:18681298:C:G,1:18684255:T:C,1:18684903:A:G,1:18685613:A:G,1:18687152:G:A,1:18696950:T:C,1:18697429:T:C,1:18697790:A:G,1:18699052:G:T,1:18699297:C:T,1:18711255:A:G,1:18711981:T:C,1:18712395:A:T,1:18725420:C:A,1:18730079:A:G,1:18730185:G:A,1:18750064:T:C,1:18762123:T:C,1:18766295:A:G,1:18768431:T:C,1:18786145:T:C,1:18786205:G:C,1:18786421:C:A,1:18786691:T:C,1:18788521:A:T,1:18793272:T:C,1:18799176:C:T,1:18806668:T:C,1:18818895:A:C,1:18822755:G:C,1:18824492:G:.,1:18831064:T:C,1:18834682:G:A,1:18849924:T:C,1:18887452:C:G,1:18890442:C:T,1:18890718:A:C,1:18890992:A:G,1:18892567:C:T,1:18896433:T:C,1:18907789:T:C,1:18907947:G:.,1:18917464:C:T,1:18919072:G:A,1:18922202:T:G,1:18939955:C:T,1:18940849:T:.,1:18950412:A:G,1:18952537:C:G,1:18956844:C:.,1:18956946:A:.,1:18957238:T:.,1:18963996:A:.,1:18966583:T:.,1:18967377:A:.,1:18967416:C:A,1:18968844:C:T,1:18971184:C:.,1:18976968:T:C,1:18981623:C:G,1:18985613:C:T,1:18985645:T:C,1:18988820:A:G,1:18992497:C:A,1:18994343:G:A,1:18998786:A:G,1:19006847:G:A,1:19012104:A:G,1:19012789:G:A,1:19015539:G:A,1:19017724:A:C,1:19026556:G:A,1:19028910:A:C,1:19039958:T:G,1:19049254:C:A,1:19109977:C:T,1:19112102:C:T,1:19114491:C:A,1:19130962:A:G,1:19136370:T:C,1:19138735:C:G,1:19149522:T:A,1:19169478:G:.,1:19194082:A:G,1:19195576:A:G,1:19195602:A:T,1:19204663:C:T,1:19205361:G:A,1:19206886:G:A,1:19215883:A:G,1:19237933:C:A,1:19238139:T:C,1:19243575:G:A,1:19246192:T:C,1:19247039:T:C,1:19247051:C:.,1:19248604:A:G,1:19252434:C:G,1:19263764:A:G,1:19265620:C:T,1:19273278:C:G,1:19277824:T:C,1:19280358:T:C,1:19280917:T:.,1:19281237:T:C,1:19286513:C:G,1:19287401:A:G,1:19287891:G:A,1:19288026:T:C,1:19289366:C:.,1:19306199:T:A,1:19306336:A:G,1:19308019:G:T,1:19309772:T:G,1:19315095:C:T,1:19325952:A:C,1:19329844:G:T,1:19334188:A:G,1:19343249:G:A,1:19353416:A:C,1:19359958:G:.,1:19361426:C:A,1:19365294:T:C,1:19371707:G:A,1:19372915:T:C,1:19385103:C:T,1:19398072:G:T,1:19398172:T:C,1:19415704:C:T,1:19421568:T:C,1:19430300:G:C,1:19432550:G:A,1:19436624:A:G,1:19436636:A:G,1:19436789:A:G,1:19442491:T:C,1:19448622:C:T,1:19454925:A:C,1:19456591:A:G,1:19459158:G:A,1:19459554:C:T,1:19476961:A:T,1:19491188:G:A,1:19508628:A:G,1:19513285:C:.,1:19517942:G:A,1:19518260:A:G,1:19519352:G:A,1:19533080:G:A,1:19533457:C:T,1:19534692:T:C,1:19535670:C:T,1:19540139:A:G,1:19543034:G:.,1:19549013:A:.,1:19549101:G:.,1:19549675:C:T,1:19553131:G:A,1:19561866:A:G,1:19562443:A:C,1:19564341:T:C,1:19565715:T:G,1:19566237:T:G,1:19569965:T:C,1:19570502:T:C,1:19570613:C:T,1:19571411:A:C,1:19571448:C:A,1:19571933:G:A,1:19574960:C:T,1:19579584:A:G,1:19579889:T:C,1:19591411:T:C,1:19596666:C:A,1:19596687:A:G,1:19599732:A:C,1:19600330:C:G,1:19601674:G:C,1:19603514:C:T,1:19610777:T:C,1:19611897:G:.,1:19613410:A:C,1:19614727:T:C,1:19619186:C:T,1:19621989:C:T,1:19622437:A:G,1:19622481:T:C,1:19626434:T:C,1:19632422:G:A,1:19635966:T:C,1:19635983:T:G,1:19637591:C:G,1:19637792:C:G,1:19638105:G:T,1:19638256:T:C,1:19641958:T:C,1:19645434:T:C,1:19648153:T:C,1:19648398:G:A,1:19652260:G:A,1:19664543:G:A,1:19665114:G:A,1:19666571:G:A,1:19666774:G:T,1:19669835:A:G,1:19672216:C:A,1:19673541:G:A,1:19673855:T:C,1:19678584:G:C,1:19678846:G:A,1:19681415:T:.,1:19681653:A:G,1:19711726:G:A,1:19715941:C:T,1:19716163:G:A,1:19730800:T:G,1:19730858:G:A,1:19733284:T:A,1:19733427:G:C,1:19734998:C:T,1:19745377:T:C,1:19748612:C:A,1:19749025:T:C,1:19762509:G:A,1:19765387:G:C,1:19766327:T:C,1:19768807:G:A,";
    
    char *params[3] = { "of", "variants", "exclude" };
    char *params_values[3] = { output_format, variants, NULL };
    
    // Output buffer
#pragma omp parallel
    {
    char *buffer = NULL;
    CURLcode ret_code = http_post(url, params, params_values, 3, save_response_to_buffer, &buffer);
    
    printf("%s", buffer);
    }
    free(url);
    
    return (EXIT_SUCCESS);
}


int init_http_environment(int ssl) {
    if (ssl) {
        return curl_global_init(CURL_GLOBAL_SSL);
    } else {
        return curl_global_init(CURL_GLOBAL_NOTHING);
    }
}

int http_post(char *url, char **params, char **params_values, int num_params, size_t (*write_function) (char*, size_t, size_t, void*), void *buffer) {
    CURL *curl;
    CURLcode ret_code = CURLE_OK;

    struct curl_httppost *formpost = NULL;
    struct curl_httppost *lastptr = NULL;
    
    // Set request parameters
    for (int i = 0; i < num_params; i++) {
        curl_formadd(&formpost, &lastptr,
                     CURLFORM_COPYNAME, params[i],
                     CURLFORM_PTRCONTENTS, params_values[i],
                     CURLFORM_END);
    }
    
    curl = curl_easy_init();
    
    if(curl) {
//         if (debug) { curl_easy_setopt(curl, CURLOPT_VERBOSE, 1); }
        
        buffer_size = CURL_MAX_WRITE_SIZE;
        curl_easy_setopt(curl, CURLOPT_URL, url);
        curl_easy_setopt(curl, CURLOPT_HTTPPOST, formpost);
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_function);
	curl_easy_setopt(curl, CURLOPT_WRITEDATA, buffer);
        // Option for avoiding a segfault caused by a signal in libcurl
        // http://stackoverflow.com/questions/9191668/error-longjmp-causes-uninitialized-stack-frame
        curl_easy_setopt(curl, CURLOPT_NOSIGNAL, 1);
        
        ret_code = curl_easy_perform(curl);
        if (ret_code != 0) { fprintf(stderr, "ret_code = %s\n", curl_easy_strerror(ret_code)); }

        curl_easy_cleanup(curl);
        curl_formfree(formpost);
    } else {
        ret_code = CURLE_FAILED_INIT;
    }
    
    return ret_code;
}

const char *get_last_http_error(int err_code) {
    return curl_easy_strerror(err_code);
}

size_t save_response_to_buffer(char *contents, size_t size, size_t nmemb, void *userdata) {
    char **buffer_ptr = (char**) userdata;
    if (!(*buffer_ptr)) { // First call
        printf("Init buffer!\n");
        *buffer_ptr = calloc(buffer_size, sizeof(char));
    }

    // Concatenate contents to already existing buffer
    strncat(*buffer_ptr, contents, size * nmemb); 

    // In each call it is necessary to resize the buffer
    char *buffer = realloc (*buffer_ptr, buffer_size + size * nmemb);
    if (buffer) {
        *buffer_ptr = buffer;
        buffer_size += size * nmemb;
    } else {
        LOG_FATAL("Error while allocating memory for web service response");
    }

    return size * nmemb;
}
